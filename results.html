<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lough 5 - Results</title>
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="assets/style.css">
  <script defer src="assets/js/bundle.js"></script>
</head>
<body>
  <header class="header">
    <nav class="navbar">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="results.html" class="current">Results</a></li>
        <li><a href="records.html">Records</a></li>
        <li><a href="location.html">Location</a></li>
        <li><a href="course.html">Course</a></li>
      </ul>
    </nav>
  </header>

  <section class="section">
    <div class="container" x-data="resultsApp()">
      <h2 class="section-title">
        <span x-text="selectedYear"></span> Results
      </h2>
      <p class="card-section-text" x-show="selectedYear === '2020'">Note, the 2020 race was virtual because of COVID</p>
      <div class="card">
        <div class="search-container">
          <div class="filter-row filter-row-wrap">
            <select x-model="selectedYear" class="year-dropdown">
              <option value="2024">2024</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              <option value="2020">2020</option>
              <option value="2019">2019</option>
              <option value="2018">2018</option>
              <option value="2017">2017</option>
              <option value="2016">2016</option>
              <option value="2015">2015</option>
              <option value="2014">2014</option>
              <option value="2013">2013</option>
              <option value="2012">2012</option>
              <option value="2011">2011</option>
              <option value="2010">2010</option>
              <option value="2009">2009</option>
            </select>
            <label class="toggle-label female-toggle">
              <input type="checkbox" x-model="femaleOnly" class="toggle-checkbox">
              <span class="toggle-switch"></span>
              <span class="toggle-emoji">üèÉ‚Äç‚ôÄÔ∏è</span>
            </label>
            <input
              type="text"
              x-model="searchTerm"
              placeholder="Search by bib, name, category, or club..."
              class="search-input search-input-wrap"
            >
          </div>
        </div>

        <!-- Runner Details Modal -->
        <div class="modal" x-show="showModal" x-cloak>
          <div class="modal-content">
            <div class="modal-header">
              <h3 x-text="selectedRunner.name"></h3>
              <span class="close-btn" @click="showModal = false">&times;</span>
            </div>
            <div class="modal-body">
              <div class="runner-detail">
                <span class="detail-label">Position:</span>
                <span class="detail-value">
                  <span x-text="selectedRunner.position"></span>
                </span>
              </div>
              <div class="runner-detail" x-show="selectedRunner.awards && selectedRunner.awards.length > 0">
                <span class="detail-label">Awards:</span>
                <span class="detail-value" x-html="selectedRunner.awards ? selectedRunner.awards.join('<br>') : ''"></span>
              </div>
              <div class="runner-detail" x-show="showBibNumber">
                <span class="detail-label">Bib Number:</span>
                <span class="detail-value" x-text="selectedRunner.bib"></span>
              </div>
              <div class="runner-detail">
                <span class="detail-label">Category:</span>
                <span class="detail-value" x-text="selectedRunner.age_group"></span>
              </div>
              <div class="runner-detail">
                <span class="detail-label">Club:</span>
                <span class="detail-value" x-text="selectedRunner.club"></span>
              </div>
              <div class="runner-detail" x-show="showTwoMiles">
                <span class="detail-label">2 Miles:</span>
                <span class="detail-value" x-text="selectedRunner.two_miles"></span>
              </div>
              <div class="runner-detail" x-show="showLapOfLough">
                <span class="detail-label">Lap of Lough:</span>
                <span class="detail-value" x-text="selectedRunner.lap_of_lough"></span>
              </div>
              <div class="runner-detail">
                <span class="detail-label">Chip Time:</span>
                <span class="detail-value" x-text="selectedRunner.chip_time"></span>
              </div>
              <div class="runner-detail" x-show="showGunTime">
                <span class="detail-label">Gun Time:</span>
                <span class="detail-value" x-text="selectedRunner.gun_time"></span>
              </div>
            </div>
            <div class="modal-footer">
              <a x-show="selectedRunner.runner_id" :href="getRunnerStatsUrl(selectedRunner)" class="btn">View Runner Stats</a>
              <button class="btn btn-secondary" @click="showModal = false">Close</button>
            </div>
          </div>
        </div>

        <div x-show="isLoading" class="loading-spinner-container">
          <div class="loading-spinner"></div>
          <p>Loading results...</p>
        </div>

        <div x-show="!isLoading" class="table-container results-table">
          <table>
            <thead>
              <tr>
                <th class="chevron-column"></th>
                <th class="pos-column">Pos.</th>
                <th class="pos-highlight-column">Pos.</th>
                <th class="awards-column">Awards</th>
                <th class="bib-column" x-show="showBibNumber">Bib</th>
                <th class="name-column">Name</th>
                <th class="cat-column">Cat.</th>
                <th class="club-column">Club</th>
                <th class="two-miles-column" x-show="showTwoMiles">2 Miles</th>
                <th class="lap-lough-column" x-show="showLapOfLough">Lap of Lough</th>
                <th class="chip-time-column">Chip Time</th>
                <th class="gun-time-column" x-show="showGunTime">Gun Time</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="runner in filteredResults" :key="runner.position">
                <tr @click="showRunnerDetails(runner)">
                  <td class="chevron-cell chevron-column" x-show="isMobileView"><span class="right-chevron">‚Ä∫</span></td>
                  <td data-label="Pos." class="pos-column" x-text="runner.position"></td>
                  <td data-label="Pos." class="pos-highlight-column" x-text="runner.highlight ? runner.position + ' ' + runner.highlight : runner.position"></td>
                  <td data-label="Awards" class="awards-cell awards-column" x-html="runner.awards.join('<br>')"></td>
                  <td data-label="Bib" class="bib-column" x-show="showBibNumber" x-text="runner.bib"></td>
                  <td data-label="Name" class="name-column" x-text="runner.name"></td>
                  <td data-label="Cat." class="cat-column" x-text="runner.age_group"></td>
                  <td data-label="Club" class="club-column" x-text="runner.club"></td>
                  <td data-label="2 Miles" class="two-miles-column" x-show="showTwoMiles" x-text="runner.two_miles"></td>
                  <td data-label="Lap of Lough" class="lap-lough-column" x-show="showLapOfLough" x-text="runner.lap_of_lough"></td>
                  <td data-label="Chip Time" class="chip-time-column" x-text="runner.chip_time"></td>
                  <td data-label="Gun Time" class="gun-time-column" x-show="showGunTime" x-text="runner.gun_time"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>

        <div x-show="!isLoading && filteredResults.length === 0" style="text-align: center; padding: 20px;">
          <p>No results found. Try a different search.</p>
        </div>
      </div>

      <!-- Popup Notification for Mobile View -->
      <div class="popup-notification" x-show="showPopupNotification" x-transition x-cloak :class="{ 'show': showPopupNotification }">
        <div class="popup-content">
          <p><span class="right-chevron">‚Ä∫</span>Tap rows for more info</p>
          <button class="btn" @click="dismissPopupNotification">Got it</button>
        </div>
      </div>
    </div>
  </section>

</body>
</html>
