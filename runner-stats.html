<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lough 5 - Runner Stats</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="assets/style.css">
    <script defer src="assets/js/bundle.js"></script>
</head>
<body>
<header class="header">
    <nav class="navbar">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="results.html">Results</a></li>
            <li><a href="records.html">Records</a></li>
            <li><a href="location.html">Location</a></li>
            <li><a href="course.html">Course</a></li>
        </ul>
    </nav>
</header>

<section class="section">
    <div class="container" x-data="runnerStatsPage()">

        <div x-show="isLoading" class="loading-spinner-container">
            <div class="loading-spinner"></div>
            <p>Loading runner stats...</p>
        </div>

        <div x-show="error" style="text-align: center; padding: 20px;">
            <h2 class="section-title">Runner Not Found</h2>
            <p x-text="error"></p>
            <a href="runner-search.html" class="btn" style="display: inline-block; margin-top: 20px;">Back to Search</a>
        </div>

        <template x-if="!isLoading && !error && runner">
            <div>
                <h2 class="section-title" x-text="runner.name"></h2>
                <p style="font-size: 24px; color: #666; margin-top: -1rem; margin-bottom: 1.5rem; text-align: center;" x-text="runner.most_frequent_club"></p>

                <!-- Profile Headline -->
                <template x-if="runner.profile && runner.profile.headline">
                    <p style="font-size: 18px; color: #555; font-style: italic; margin-top: -0.5rem; margin-bottom: 1.5rem; text-align: center;" x-text="runner.profile.headline"></p>
                </template>

                <!-- Headline Stats -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 class="card-section-title">Career Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Total Races</span>
                            <span class="stat-value" x-text="runner.total_races"></span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Best Time</span>
                            <span class="stat-value"
                                  x-text="runner.best_time ? runner.best_time.time + ' (' + runner.best_time.year + ')' : 'N/A'"></span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Best Position</span>
                            <span class="stat-value"
                                  x-text="runner.best_position ? runner.best_position.position + ' (' + runner.best_position.year + ')' : 'N/A'"></span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Years Active</span>
                            <span class="stat-value" x-text="formatYearsActive(runner.years_active)"></span>
                        </div>
                    </div>
                </div>

                <!-- Badges -->
                <div class="card" style="margin-bottom: 2rem;" x-show="hasBadges()">
                    <h3 class="card-section-title">Achievements</h3>

                    <div class="badges-section">
                        <template x-if="runner.badges.fastest_all_time">
                            <div class="badge-item">
                                <strong>üèÜ Fastest All-Time:</strong>
                                <a :href="getRecordsUrl('fastest_all_time', runner.badges.fastest_all_time.gender, runner.runner_id)" class="badge-tag badge-link" x-text="'#' + runner.badges.fastest_all_time.position + ' ' + (runner.badges.fastest_all_time.gender === 'M' ? 'Male' : 'Female')"></a>
                            </div>
                        </template>

                        <template x-if="runner.badges.overall_podiums && runner.badges.overall_podiums.length > 0">
                            <div class="badge-item">
                                <strong>ü•á Overall Podiums:</strong>
                                <template x-for="podium in runner.badges.overall_podiums" :key="podium.year">
                                    <a :href="getResultsUrl(runner, podium.year)" class="badge-tag badge-link"
                                          x-text="getOrdinal(podium.position) + ' (' + podium.year + ')'"></a>
                                </template>
                            </div>
                        </template>

                        <template x-if="runner.badges.category_podiums && runner.badges.category_podiums.length > 0">
                            <div class="badge-item">
                                <strong>üéñÔ∏è Category Podiums:</strong>
                                <template x-for="podium in runner.badges.category_podiums"
                                          :key="podium.year + podium.category">
                                    <a :href="getResultsUrl(runner, podium.year)" class="badge-tag badge-link"
                                          x-text="getOrdinal(podium.position) + ' ' + podium.category + ' (' + podium.year + ')'"></a>
                                </template>
                            </div>
                        </template>

                        <template x-if="runner.badges.age_group_records && runner.badges.age_group_records.length > 0">
                            <div class="badge-item">
                                <strong>üìä Age Group Records:</strong>
                                <template x-for="record in runner.badges.age_group_records" :key="record.category">
                                    <a :href="getRecordsUrl('age_group_records', record.category.startsWith('M') ? 'M' : 'F', runner.runner_id)" class="badge-tag badge-link"
                                          x-text="record.category + ' - ' + record.time + ' (' + record.year + ')'"></a>
                                </template>
                            </div>
                        </template>

                        <!-- Profile Story (Collapsible) -->
                        <template x-if="runner.profile && runner.profile.above_the_fold">
                            <div class="badge-item" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;" x-data="{ expanded: false }">
                                <div style="line-height: 1.6; color: #333;">
                                    <span x-show="!expanded" x-text="runner.profile.above_the_fold.substring(0, 150) + '...'"></span>
                                    <span x-show="expanded" x-text="runner.profile.above_the_fold"></span>
                                    <button @click="expanded = !expanded"
                                            style="background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 0.9rem; padding: 0; margin-left: 0.5rem; text-decoration: underline;"
                                            x-text="expanded ? 'less' : 'more'">
                                    </button>
                                </div>

                                <!-- External Links -->
                                <template x-if="runner.profile.power_of_10 || runner.profile.world_athletics || (runner.profile.additional_links && runner.profile.additional_links.length > 0)">
                                    <div style="margin-top: 1rem;">
                                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                            <template x-if="runner.profile.power_of_10">
                                                <a :href="runner.profile.power_of_10" target="_blank" rel="noopener noreferrer"
                                                   style="display: inline-block; padding: 0.25rem 0.75rem; background: #f0f0f0; border-radius: 4px; font-size: 0.85rem; color: #333; text-decoration: none; transition: background 0.2s;"
                                                   @mouseenter="$el.style.background = '#e0e0e0'"
                                                   @mouseleave="$el.style.background = '#f0f0f0'">
                                                    Power of 10 ‚Üó
                                                </a>
                                            </template>
                                            <template x-if="runner.profile.world_athletics">
                                                <a :href="runner.profile.world_athletics" target="_blank" rel="noopener noreferrer"
                                                   style="display: inline-block; padding: 0.25rem 0.75rem; background: #f0f0f0; border-radius: 4px; font-size: 0.85rem; color: #333; text-decoration: none; transition: background 0.2s;"
                                                   @mouseenter="$el.style.background = '#e0e0e0'"
                                                   @mouseleave="$el.style.background = '#f0f0f0'">
                                                    World Athletics ‚Üó
                                                </a>
                                            </template>
                                            <template x-if="runner.profile.additional_links && runner.profile.additional_links.length > 0">
                                                <template x-for="(link, index) in runner.profile.additional_links" :key="link">
                                                    <a :href="link" target="_blank" rel="noopener noreferrer"
                                                       style="display: inline-block; padding: 0.25rem 0.75rem; background: #f0f0f0; border-radius: 4px; font-size: 0.85rem; color: #333; text-decoration: none; transition: background 0.2s;"
                                                       @mouseenter="$el.style.background = '#e0e0e0'"
                                                       @mouseleave="$el.style.background = '#f0f0f0'"
                                                       x-text="'Article ' + (index + 1) + ' ‚Üó'">
                                                    </a>
                                                </template>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Historical Results -->
                <div class="card">
                    <h3 class="card-section-title">Race History</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                            <tr>
                                <th>Year</th>
                                <th>Pos. (cat.)</th>
                                <th>Cat.</th>
                                <th>Club</th>
                                <th>Time</th>
                            </tr>
                            </thead>
                            <tbody>
                            <template x-for="result in runner.results" :key="result.year">
                                <tr @click="window.location.href = getResultsUrl(runner, result.year)" class="clickable-row">
                                    <td data-label="Year" x-text="result.year"></td>
                                    <td data-label="Pos. (cat.)" x-text="result.position + ' (' + result.category_position + ')'"></td>
                                    <td data-label="Cat." x-text="result.category"></td>
                                    <td data-label="Club" x-text="result.club"></td>
                                    <td data-label="Time" x-text="result.chip_time"></td>
                                </tr>
                            </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Performance Graph -->
                <div class="card" style="margin-bottom: 2rem;" x-show="runner.results.length > 1">
                    <h3 class="card-section-title">Performance Over Time</h3>
                    <div style="position: relative; height: 300px; margin-top: 1rem;">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem; margin-bottom: 2rem; padding: 0 1rem;">
                    <p style="color: #666; font-size: 0.9rem;">
                        Please email updates/corrections to <a href="mailto:lough5@live.co.uk" style="color: var(--primary-color); text-decoration: underline;">lough5@live.co.uk</a>
                    </p>
                </div>

                <div style="text-align: center; margin-top: 2rem; margin-bottom: 2rem;">
                    <button @click="window.history.back()" class="btn btn-secondary">Back</button>
                </div>
            </div>
        </template>
    </div>
</section>

</body>
</html>
